<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src/node-win/node-win.js - Itsa</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="Itsa"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.0.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/Event.html">Event</a></li>
            
                <li><a href="../classes/Event.Emitter.html">Event.Emitter</a></li>
            
                <li><a href="../classes/Event.Listener.html">Event.Listener</a></li>
            
                <li><a href="../classes/Function.html">Function</a></li>
            
                <li><a href="../classes/IO.html">IO</a></li>
            
                <li><a href="../classes/ITSA.html">ITSA</a></li>
            
                <li><a href="../classes/Object.html">Object</a></li>
            
                <li><a href="../classes/Promise.html">Promise</a></li>
            
                <li><a href="../classes/Utils.html">Utils</a></li>
            
                <li><a href="../classes/window.html">window</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/event.html">event</a></li>
            
                <li><a href="../modules/event-dom.html">event-dom</a></li>
            
                <li><a href="../modules/event-emitter.html">event-emitter</a></li>
            
                <li><a href="../modules/event-listener.html">event-listener</a></li>
            
                <li><a href="../modules/event-mobile.html">event-mobile</a></li>
            
                <li><a href="../modules/extend-function.html">extend-function</a></li>
            
                <li><a href="../modules/extend-object.html">extend-object</a></li>
            
                <li><a href="../modules/extend-promise.html">extend-promise</a></li>
            
                <li><a href="../modules/io.html">io</a></li>
            
                <li><a href="../modules/io-assets.html">io-assets</a></li>
            
                <li><a href="../modules/io-cors.html">io-cors</a></li>
            
                <li><a href="../modules/io-jsonp.html">io-jsonp</a></li>
            
                <li><a href="../modules/io-transfer.html">io-transfer</a></li>
            
                <li><a href="../modules/io-xml.html">io-xml</a></li>
            
                <li><a href="../modules/itsa.build.html">itsa.build</a></li>
            
                <li><a href="../modules/js-ext.html">js-ext</a></li>
            
                <li><a href="../modules/node-win.html">node-win</a></li>
            
                <li><a href="../modules/utils.html">utils</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src/node-win/node-win.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&quot;use strict&quot;;

/**
 * Emulation of browser &#x60;window&#x60; and &#x60;dom&#x60;. Just enough to make ITSA work.
 *
 *
 * &lt;i&gt;Copyright (c) 2014 ITSA - https://github.com/itsa&lt;/i&gt;
 * New BSD License - http://choosealicense.com/licenses/bsd-3-clause/
 *
 * @module node-win
 * @class window
 * @static
*/


var xmlhttprequest = require(&#x27;./lib/XMLHttpRequest.js&#x27;).XMLHttpRequest,
    xmlDOMParser = require(&#x27;xmldom&#x27;).DOMParser,
    Url = require(&#x27;url&#x27;);

var used = {};

var count = function (method) {
    if (!used[method]) {
        used[method] = 1;
    } else {
        used[method] += 1;
    }
};
var vNodeParser = /(?:(^|#|\.)([^#\.\[\]]+))|(\[.+?\])/g;


var window = {},
    doc = window.document = {};

doc.childNodes = [];
doc.createElement = function(tag) {
    count(&#x27;createElement&#x27;);
    return {
        style: {},
        childNodes: [],
        nodeName: tag.toUpperCase(),
        appendChild: doc.appendChild,
        removeChild: doc.removeChild,
        replaceChild: doc.replaceChild,
        insertBefore: function(node, reference) {
            count(&#x27;insertBefore&#x27;);
            node.parentNode = this;
            var referenceIndex = this.childNodes.indexOf(reference);
            if (referenceIndex &lt; 0) {
                this.childNodes.push(node);
            } else {
                var index = this.childNodes.indexOf(node);
                this.childNodes.splice(referenceIndex, index &lt; 0 ? 0 : 1, node);
            }
        },
        insertAdjacentHTML: function(position, html) {
            count(&#x27;insertAdjacentHTML&#x27;);

            //todo: accept markup
            if (position == &quot;beforebegin&quot;) {
                this.parentNode.insertBefore(doc.createTextNode(html), this);
            } else if (position == &quot;beforeend&quot;) {
                this.appendChild(doc.createTextNode(html));
            }
        },
        setAttribute: function(name, value) {
            count(&#x27;setAttribute&#x27;);
            this[name] = value.toString();
            if (name == &#x27;href&#x27;) {
                var url = Url.parse(value);
                this.pathname = url.pathname;
                if (url.search) this.search = url.search;
            }
        },
        setAttributeNS: function(namespace, name, value) {
            count(&#x27;setAttributeNS&#x27;);
            this.namespaceURI = namespace;
            this[name] = value.toString();
        },
        getAttribute: function(name, value) {
            count(&#x27;getAttribute&#x27;);
            return this[name];
        },
        addEventListener: doc.addEventListener,
        removeEventListener: doc.removeEventListener,
        dispatchEvent: doc.dispatchEvent,
        // matchesSelector should match nested selectors like: &quot;#someid .somedivclass button.someclass&quot;
        matchesSelector: function (selector) {
            var selList = selector.replace(/( )+/g, &#x27; &#x27;).split(&#x27; &#x27;),
                size = selList.length,
                matches, i, selectorItem, node, selMatch;
            matches = function (checkNode, sel) {
                count(&#x27;matchesSelector&#x27;);
                // don&#x27;t forget to reset the found position of the previous search:
                vNodeParser.lastIndex = 0;
                var match,
                    found = false,
                    classes = checkNode.className &amp;&amp; checkNode.className.split(&#x27; &#x27;);
                /*jshint boss:true*/
                while (match = vNodeParser.exec(sel)) {
                    /*jshint boss:false*/
                    switch (match[1]) {
                        case &quot;&quot;:
                            if (checkNode.nodeName !== match[2].toUpperCase()) return false;
                            found = true;
                            break;
                        case &quot;#&quot;:
                            if (checkNode.id !== match[2]) return false;
                            found = true;
                            break;
                        case &quot;.&quot;:

                            if (!classes || classes.indexOf(match[2]) === -1) return false;
                            found = true;
                            break;
                    }
                }
                return found;
            };
            if (size===0) {
                return false;
            }
            node = this;
            selectorItem = selList[size-1];
            selMatch = matches(node, selectorItem);
            for (i=size-2; (selMatch &amp;&amp; (i&gt;=0)); i--) {
                selectorItem = selList[i];
                node = node.parentNode;
                while (node &amp;&amp; !(selMatch=matches(node, selectorItem))) {
                    node = node.parentNode;
                }
            }
            return selMatch;
        },
        getElementById: doc.getElementById,
        contains: doc.contains
    };
};
doc.createElementNS = function(namespace, tag) {
    count(&#x27;createElementNS&#x27;);
    var element = doc.createElement(tag);
    element.namespaceURI = namespace;
    return element;
};
doc.createTextNode = function(text) {
    count(&#x27;createTextNode&#x27;);
    return {nodeValue: text.toString()};
};
doc.documentElement = doc.createElement(&quot;html&quot;);
doc.replaceChild = function(newChild, oldChild) {
    count(&#x27;replaceChild&#x27;);
    var index = this.childNodes.indexOf(oldChild);
    if (index &gt; -1) this.childNodes.splice(index, 1, newChild);
    else this.childNodes.push(newChild);
    newChild.parentNode = this;
    oldChild.parentNode = null;
};
doc.appendChild = function(child) {
    count(&#x27;appendChild&#x27;);
    var index = this.childNodes.indexOf(child);
    if (index &gt; -1) this.childNodes.splice(index, 1);
    this.childNodes.push(child);
    child.parentNode = this;
};
doc.removeChild = function(child) {
    count(&#x27;removeChild&#x27;);
    var index = this.childNodes.indexOf(child);
    this.childNodes.splice(index, 1);
    child.parentNode = null;
};
doc.addEventListener = function (type, cb, capture) {
    count(&#x27;addEventListener&#x27;);
    if (!this.$on) this.$on = {};
    this.$on[type] = {
        cb: cb,
        capture: capture
    };
};
doc.removeEventListener = function (type) {
    count(&#x27;removeEventListener&#x27;);
    if (this.$on &amp;&amp; this.$on[type]) {
        delete this.$on[type];
    }
};
var EventTypes = {
    MouseEvents: function () {
        this.initMouseEvent = function (type, bubbles, cancelable, view, detail,
                screenX, screenY, clientX, clientY,
                ctrlKey, altKey, shiftKey, metaKey,
                button, relatedTarget) {
            count(&#x27;initMouseEvent&#x27;);
            this.ev = {
                type:type,
                bubbles:bubbles,
                cancelable:cancelable,
                view:view,
                detail:detail,
                screenX:screenX,
                screenY:screenY,
                clientX:clientX,
                clientY:clientY,
                ctrlKey:ctrlKey,
                altKey:altKey,
                shiftKey:shiftKey,
                metaKey:metaKey,
                button:button,
                relatedTarget:relatedTarget
            };
        };
    }
};
doc.createEvent = function (type) {
    count(&#x27;createEvent&#x27;);
    return new EventTypes[type]();
};
doc.dispatchEvent = function (event) {
    count(&#x27;dispatchEvent&#x27;);
    var branch = [],
        el = this,
        type = event.ev.type,
        cb,
        ev = event.ev;
    ev.target = this;

    while(el) {
        if (el.$on &amp;&amp; el.$on[type] &amp;&amp; el.$on[type].capture) {
            branch.push(el);
            branch.push(el.$on[type].cb);
        }
        el = el.parentNode;
    }
    while ((cb =  branch.pop())) {
        ev.currentTarget = branch.pop();
        cb.call(this, ev);
    }
    el = this;
    while (el) {
        if (el.$on &amp;&amp; el.$on[type] &amp;&amp; el.$on[type].capture === false) {
            ev.currentTarget = el;
            el.$on[type].cb.call(this, ev);
        }
        if (el[&#x27;on&#x27; + type]) {
            ev.currentTarget = el;
            el[&#x27;on&#x27; + type].call(this, ev);
        }
        el = el.parentNode;
    }
};


doc.getElementById = function (id) {
    count(&#x27;getElementById&#x27;);
    var found = null,
        find = function (el) {
            if (el.id === id) {
                found = el;
                return true;
            }
            if (el.childNodes) {
                return el.childNodes.some(find);
            }
        };
    find(doc);
    return found;
};


doc.contains = function (node) {
    count(&#x27;contains&#x27;);
    while (node &amp;&amp; node !== this) node = node.parentNode;
    return node === this;
};

window.performance = new function () {
    var timestamp = 50;
    this.$elapse = function(amount) {
        timestamp += amount;
    };
    this.now = function() {
        return timestamp;
    };
};
window.cancelAnimationFrame = function() {};
window.requestAnimationFrame = function(callback) {
    window.requestAnimationFrame.$callback = callback;
};
window.requestAnimationFrame.$resolve = function() {
    if (window.requestAnimationFrame.$callback) window.requestAnimationFrame.$callback();
    window.requestAnimationFrame.$callback = null;
    window.performance.$elapse(20);
};
window.location = {};
window.XMLHttpRequest = xmlhttprequest;
window.DOMParser = xmlDOMParser;

var getHTML = function (node) {
    var prop, val,
        style, styles = [],
        html = &#x27;&#x27;;

    if (!node.nodeName &amp;&amp; node.nodeValue !== undefined) {
        // For text nodes, I return the uppercase text
        // so that you can tell the parts generated at the server
        // from the normal lowercase of the actual app when run on the client
        return node.nodeValue.toUpperCase();
    }
    html += &#x27;&lt;&#x27; + node.nodeName;
    for (prop in node) {
        val = node[prop];

        // Ignore functions, those will be revived on the client side.
        if (typeof val == &#x27;function&#x27;) continue;
        switch (prop) {
        case &#x27;nodeName&#x27;:
        case &#x27;parentNode&#x27;:
        case &#x27;childNodes&#x27;:
        case &#x27;pathname&#x27;:
        case &#x27;search&#x27;:
            continue;
        case &#x27;checked&#x27;:
            if (val == &#x27;false&#x27;) continue;
            break;
        case &#x27;href&#x27;:
            val = node.pathname;
            break;
        case &#x27;className&#x27;:
            prop = &#x27;class&#x27;;
            break;
        case &#x27;style&#x27;:
            if (val) {
                for (style in val) {
                    if (val[style]) {
                        styles.push(style + &#x27;: &#x27; + val[style]);
                    }
                }
                if (!styles.length) continue;
                val = styles.join(&#x27;;&#x27;);
            }
            break;
        }
        html += &#x27; &#x27; + prop + &#x27;=&quot;&#x27; + val.replace(&#x27;&quot;&#x27;, &#x27;\\&quot;&#x27;) + &#x27;&quot;&#x27;;
    }

    if (node.childNodes.length) {
        html += &#x27;&gt;&#x27; + node.childNodes.reduce(function (prev, node) {
            return prev + getHTML(node);
        }, &#x27;&#x27;) + &#x27;&lt;/&#x27; + node.nodeName + &#x27;&gt;&#x27;;
    } else {
        // I don&#x27;t know why Mithril assigns the content of textareas
        // to its value attribute instead of the innerHTML property.
        // Since it doesn&#x27;t have children, the closing tag has to be forced.
        if (node.nodeName == &#x27;TEXTAREA&#x27;) {
            html += &#x27;&gt;&lt;/TEXTAREA&gt;&#x27;;
        } else {
            html += &#x27;/&gt;&#x27;;
        }
    }
    return html;
};
var reset = function () {
    window.location.search = &quot;?/&quot;;
    window.location.pathname = &quot;/&quot;;
    window.location.hash = &quot;&quot;;
    window.history = {};
    window.history.pushState = function(data, title, url) {
        window.location.pathname = window.location.search = window.location.hash = url;
    },
    window.history.replaceState = function(data, title, url) {
        window.location.pathname = window.location.search = window.location.hash = url;
    };
    var _body = doc.createElement(&#x27;body&#x27;);
    doc.appendChild(_body);
    doc.body = _body;
};
reset();

window.navigator = {

    userAgent: &#x27;fake&#x27;,
    stats: {
        clear: function () {
            used = {};
        },
        get: function () {
            return used;
        }
    },
    reset: reset,
    getHTML: function () {
        return getHTML(doc.body);
    },
    navigate: function (url) {
        var u = Url.parse(url, false, true);
        window.location.search = u.search || &#x27;&#x27;;
        window.location.pathname = u.pathname || &#x27;&#x27;;
        window.location.hash = u.hash || &#x27;&#x27;;
    }
};

module.exports = window;

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
